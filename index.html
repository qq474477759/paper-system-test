<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microgestures Trove</title>
    <link rel="stylesheet" href="https://qq474477759.github.io/paper-system-test/static/css/style.css">
</head>
<body>
    <!-- Main Header -->
    <header class="main-header">
        <h1>Microgestures Trove</h1>
    </header>

    <!-- Navigation bar -->
    <nav class="navbar">
        <a href="#">Home</a>
        <a href="#">About Us</a>
        <a href="#">Contact Us</a>
    </nav>
    
    <section class="search-section">
        <form method="GET" class="search-form">
            <div class="search-container">
                <!-- Search Box -->
                <div class="input-group">
                    <label for="query" class="input-label">Paper Title</label>
                    <input type="text" name="query" id="query" placeholder="Enter paper title to search..." class="search-input">
                </div>
                <div class="input-group">
                    <label for="author" class="input-label">Author</label>
                    <input type="text" name="author" id="author" placeholder="Enter author's name" class="filter-input">
                </div>
                
                <div class="input-group">
                    <label for="year" class="input-label">Year</label>
                    <input type="number" name="year" id="year" placeholder="For example: 2020" class="filter-input">
                </div>

                <!-- Sort and Order -->
                <div class="sort-container">
                    <div class="input-group">
                        <label for="sort_by" class="input-label">Sort By</label>
                        <select name="sort_by" id="sort_by" class="sort-select">
                            <option value="year">By Year</option>
                            <option value="title">By Title</option>
                            <option value="category">By Category</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="order" class="input-label">Sort Order</label>
                        <select name="order" id="order" class="order-select">
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>
                </div>

                <!-- Filter Button -->
                <button type="submit" class="filter-button">Filter</button>
            </div>
        </form>
    </section>

    <div id="papers-count">
        Showing <span id="papers-count-number">0</span> papers
    </div>

    <!-- Main Content Section: Papers List on the Left, Filter Panel on the Right -->
    <div class="main-content">
        <!-- Left side: Papers List -->
        <section class="papers-list" id="papers-list">
            <!-- Papers will be dynamically added here using JavaScript -->
        </section>

        <!-- Right side: Filter Panel -->
        <section id="feature-filters">
            <h2>Filters</h2>
            <label for="select-all-all-categories">
                <input type="checkbox" id="select-all-all-categories" />
                Select All Features
            </label>
            <div id="feature-categories"></div> <!-- Container for dynamically loaded categories and features -->
        </section>
    </div>

    <!-- Modal for Paper Details -->
    <div id="paperModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="paperTitle"></h2>
            </div>
            <div class="modal-body">
                <div class="left-content">
                    <img id="paperPreviewImage" src="" alt="Preview Image" class="preview-image">
                    <div class="info-item">
                        <strong>DOI:</strong>
                        <a id="doiLink" href="" target="_blank">
                            <span id="doiLinkText"></span>
                        </a>
                    </div>
                    <div class="info-item">
                        <strong>Journal/Conference:</strong> <span id="journalConferenceName"></span>
                    </div>
                    <div class="info-item">
                        <strong>Year:</strong> <span id="paperYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>Category:</strong> <span id="paperCategory"></span>
                    </div>

                    <div id="paperFeatures" class="info-item">
                        <strong>Features:</strong>
                        <div id="featuresContainer"></div> 
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="button" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>
    <script>
        
function fetchPapers() {
    fetch('http://8.215.43.250:5000/api/papers')
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch papers');
            }
            return response.json();
        })
        .then(papers => {
            // Render papers dynamically
            renderPapers(papers);
        })
        .catch(error => {
            console.error('Error fetching papers:', error);
            alert('Unable to load papers, please try again later');
        });
}

        // Call the fetchPapers function when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            fetchPapers();
        });
    </script>
    <!-- JS File -->
    <script src="https://qq474477759.github.io/paper-system-test/static/js/script.js"></script>
    <script>
    
        var allPapers = [];  
        console.log(allPapers)

        const papersCountElement = document.getElementById('papers-count-number');
        papersCountElement.textContent = allPapers.length;

        // 渲染论文数据
        function renderPapers() {
            const papersList = document.getElementById('papers-list');
            papersList.innerHTML = '';  // 清空当前内容

            allPapers.forEach(paper => {
                const paperElement = document.createElement('div');
                paperElement.classList.add('paper-card');
                paperElement.innerHTML = `
                    <img src="http://8.215.43.250:5000/images/${paper.preview_image}" alt="Preview Image">
                    <div class="paper-details">
                        <h3 onclick="openModal(${paper.id})">${paper.title}</h3>
                        <p>Category: ${paper.category} | Year: ${paper.year}</p>
                    </div>
                `;
                papersList.appendChild(paperElement);
            });
        }

        // 在这里加载论文数据
        renderPapers();

        // Open the modal and load paper data
        function openModal(paperId) {
            fetch(`http://8.215.43.250:5000/paper_info/${paperId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load data');
                    }
                    return response.json();
                })
                .then(data => {
                    // Populate modal with data
                    document.getElementById('paperTitle').innerText = data.title;
                    document.getElementById('paperYear').innerText = data.year || 'Unknown Year';
                    document.getElementById('paperCategory').innerText = data.category || 'Unknown Category';
                    document.getElementById('paperPreviewImage').src = `http://8.215.43.250:5000/images/${data.preview_image}`;

                    // New fields: Journal/Conference Name and DOI
                    document.getElementById('journalConferenceName').innerText = data.journal_conference_name || 'Unknown';
                    const doiLink = document.getElementById('doiLink');
                    if (data.doi) {
                        doiLink.href = `https://doi.org/${data.doi}`;
                        document.getElementById('doiLinkText').innerText = data.doi;
                    } else {
                        doiLink.href = '#';
                        document.getElementById('doiLinkText').innerText = 'N/A';
                    }

                    // Features section
                    const featuresContainer = document.getElementById('featuresContainer');
                    featuresContainer.innerHTML = '';  // Clear previous content

                    let displayedCategories = [];
                    data.features.forEach(feature => {
                        const featureCategory = featureCategoryMap[feature];  // Get the category of the feature

                        if (featureCategory && !displayedCategories.includes(featureCategory)) {
                            const categoryDiv = document.createElement('div');
                            categoryDiv.classList.add('feature-category');

                            const categoryTitle = document.createElement('h4');
                            categoryTitle.textContent = featureCategory;  // Display the category

                            categoryDiv.appendChild(categoryTitle);
                            featuresContainer.appendChild(categoryDiv);

                            displayedCategories.push(featureCategory);

                            featuresContainer.appendChild(document.createElement('br'));  // Empty line between category and features
                        }

                        const featureRow = document.createElement('div');
                        featureRow.classList.add('feature-row');

                        const label = document.createElement('div');
                        label.classList.add('feature-label');
                        label.textContent = feature;  // Display the feature

                        const value = document.createElement('div');
                        value.classList.add('feature-value');
                        featureRow.appendChild(label);

                        featuresContainer.appendChild(featureRow);
                    });

                    const modal = document.getElementById('paperModal');
                    modal.style.display = 'block'; // Ensure it is visible
                    setTimeout(() => {
                        modal.classList.add('show');
                    }, 50);
                    document.body.classList.add('modal-open');
                })
                .catch(error => {
                    console.error('Failed to load paper:', error);
                    alert('Unable to load paper details, please try again later'); // Error message
                });
        }

        // Close the modal
        function closeModal() {
            const modal = document.getElementById('paperModal');
            modal.classList.remove('show'); // Remove the "show" class to trigger exit animation
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.classList.remove('modal-open'); // Restore scrolling
            }, 400); // Matches CSS transition time
        }
    </script>
</body>
</html>
